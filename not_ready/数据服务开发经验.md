---
title: "数据服务开发经验"
date: 2018-07-10T09:13:30+08:00
draft: true
categories: ["后端架构"]
tags: ["后端架构"]
topics: ["后端架构"]
---

有状态服务或者说数据服务，上线遇到问题很棘手，回滚无济于事；而且数据加载通常都很慢，部署时间长；最终导致不敢修改代码，谨小慎微；服务质量也是能忍就忍，不愿意深度优化。在我负责顺风车LBS以来，感受愈加强烈。区别于无状态服务，数据服务的几个方面需要格外关注：

* 数据分片：多主或主从，前者多写+负载均衡读，实现简单，稳定性高；后者可以读写分离，数据一致性不依赖上游；
* 数据同步：根据数据分片逻辑，选择不同同步方式：主从同步或上游同步，RPC或者MQ；
* 数据存储：稳定是第一要务，binlog或者leveldb都能满足；要能支持并发加载，提高启动速度；
* 数据格式：能随时增删字段，做到新旧版本兼容；尽可能满足多种类型需求；
* 数据校验：数据校验意味着所见即所得，能及时发现问题，及时恢复数据；

还有两个无状态服务也会面临的重点，功能边界划分和线下环境搭建：内部数据服务不同于开源项目，常常会与业务逻辑耦合，提高性能，简化代码逻辑；但是功能边界模糊最终会导致逻辑混乱，层次复杂。QA经常喜欢直连线上环境，数据充分，便于发现问题；但这其实会污染线上数据，而且不容易发现问题，裸奔上线；一套良好的线下环境使用规范，配合数据和逻辑校验工具，能极大降低风险。

最后还有一点，适用于任何代码：简单，能做到多简单就多简单。

下面我根据自己的经验，结合一些优秀开源项目，详细谈谈这些点该怎么设计和实现。

